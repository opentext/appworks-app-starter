/*! appworks-js 2015-08-17 copyright OpenText Inc */
function AppWorksCore(){"use strict";function a(a){return JSON.stringify({action:a,callbackID:d.getNewCallbackId()})}var b=[],c=[];String.random=function(){var a=16;return Math.round(Math.pow(36,a+1)-Math.random()*Math.pow(36,a)).toString(36).slice(1)};var d={blackberryCommunication:function(a,d,e){d&&b.push(d),e&&c.push(e),navigator.cascades.postMessage(encodeURIComponent(a))},getNewCallbackId:function(){return window.otag&&window.otag.pageUUID?window.otag.pageUUID+"_"+b.length:b.length},getNewErrorCallbackId:function(){return c.length},isOnline:function(b){var c=a("isOnline");this.blackberryCommunication(c,b)},getComponents:function(b){var c=a("getComponents");this.blackberryCommunication(c,b)},downloadFile:function(a,b,c){this.blackberryCommunication(JSON.stringify(a),function(a){b(a.data)},function(a){c(a.data)})},createDownloadRequest:function(a,b,c,d,e,f,g){if(arguments.length<5)throw new Error("insufficient arguments supplied");var h={action:"downloadFile",callbackID:this.getNewCallbackId(),errorCallbackID:this.getNewErrorCallbackId(),fileName:a,relativePath:b,headers:c,queryParams:d,openOnReturn:e};return"undefined"!=typeof f&&(h.cacheRequest=f),"undefined"!=typeof g&&(h.destinationPath=g),h},uploadFile:function(a,b,c){this.blackberryCommunication(JSON.stringify(a),function(a){b(a.data)},function(a){c(a.data)})},createUploadRequest:function(a,b,c,d){var e={action:"uploadFile",relativePath:a,headers:b,queryParams:c,formData:d,callbackID:this.getNewCallbackId(),errorCallbackID:this.getNewErrorCallbackId()};return e},createFormField:function(a,b,c,d,e){var f={name:a,inputType:b,value:c};return"undefined"!=typeof d&&(f.fileName=d),"undefined"!=typeof e&&(f.contentType=e),f},selectFilePath:function(b){var c=a("selectFilePath");this.blackberryCommunication(c,b)},camera:{takePicture:function(a,b,c){function e(c){var e={fileSystem:LocalFileSystem.TEMPORARY,resolveLocalFileSystemURL:!0};d.storage.getFile(c,a,b,e)}c=c||{destinationType:Camera.DestinationType.FILE_URI,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.ALLMEDIA,correctOrientation:!0,saveToPhotoAlbum:!0},navigator.camera.getPicture(d.storage&&e||a,b,c)},chooseFromLibrary:function(a,b,c){function e(c){var e={fileSystem:LocalFileSystem.TEMPORARY,resolveLocalFileSystemURL:!0};d.storage.getFile(c,a,b,e)}c=c||{sourceType:Camera.PictureSourceType.PHOTOLIBRARY},navigator.camera.getPicture(d.storage&&e||a,b,c)}}};return d}function AppWorksCache(a){"use strict";function b(b,d){return JSON.stringify({action:c+b,callbackID:a.getNewCallbackId(),cacheRequest:JSON.stringify(d)})}var c="cache.",d={getBaseCacheRequest:function(a,b,c){if(null===a)throw new Error("fileName cannot be null");if("undefined"==typeof a||"undefined"==typeof b||"undefined"==typeof c)throw new Error("All arguments must be defined, they can be null apart from fileName");var d=null!==b?b:"general",e=null!==c?c:"default";return{fileName:a,app:d,version:e}},getCacheInfo:function(c){var d=b("getCacheInfo");a.blackberryCommunication(d,c)},getCacheItemInfo:function(c,d){var e=b("getCacheItemInfo",c);a.blackberryCommunication(e,d)},getCacheItem:function(c,d,e){if("boolean"!=typeof d)throw new Error("openOnReturn must be specified as a boolean value");var f;c.openOnReturn=d,f=b("getCacheItem",c),a.blackberryCommunication(f,e)},isItemInCache:function(a,c){var d=b("isItemInCache",a);AppWorks.blackberryCommunication(d,c)},setItem:function(a,b,c){c=c||{};var d=c.expiry||(new Date).getTime()+864e5,e=JSON.stringify({value:b,expires:d});return window.localStorage.setItem(a,e)},getItem:function(a,b){var c=JSON.parse(window.localStorage.getItem(a));c&&c.expires>(new Date).getTime()?b(c.value):(window.localStorage.removeItem(a),b(null))},removeItem:function(a){return window.localStorage.removeItem(a)},clear:function(){return window.localStorage.clear()}};return d}function AppWorksComms(aw){"use strict";var awComms={openApp:function(a){if(!a||!a.name)throw new Error("Unable to open another app without the name of the app/component to open");var b='{"action": "openApp", "commsRequest": '+JSON.stringify(a)+"}";aw.blackberryCommunication(b)},processComms:function(a){var b=this.getCommsData();"undefined"!=typeof b&&(b.method&&this.callMethodFromComms(b.method,b.data),"function"==typeof a&&a(b.data))},callMethodFromComms:function(methodName,data){var toEval="window.";methodName?(toEval+=methodName+"(",data&&(toEval+=JSON.stringify(data)),toEval+=")",eval(toEval)):console.log("Unable lo callMethodFromComms as no methodName was supplied")},getCommsData:function(){var a=null,b=null;try{if(b=decodeURIComponent(window.location.search.toString().substring(1)),a=JSON.parse(b),!a.appWorksComms)return console.log("parsed the window.location.search but did not find the appWorksComms data"),{}}catch(c){console.log("failed to parse comms object from window.location - "+b)}return a&&a.appWorksComms?{}:a.appWorksComms},getOpenAppRequest:function(a,b,c,d){if(!a)throw new Error('"toName" is mandatory');"boolean"!=typeof d&&(d=!1);var e={name:a,method:"",data:{},refreshOnReturn:d};return b&&(e.method=b),c&&(e.data=c),e}};return awComms}function AppWorksStorage(a){"use strict";function b(b,c,e){function f(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}return JSON.stringify(f({action:d+b,callbackID:a.getNewCallbackId(),data:JSON.stringify(c)},e||{}))}function c(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b="Unknown Error"}alert("Error: "+b)}var d="storage.",e="Invalid request object passed to function.",f={put:function(c,d){if(!c.app||!c.dataType||!c.id)throw new Error(e);var f=b("put",c);a.blackberryCommunication(f,d)},getItemFromStore:function(c,d,f,g){if(!c||!d||!f)throw new Error(e);var h=b("getItem",null,{app:c,dataType:d,id:f});a.blackberryCommunication(h,g)},getByTypeFromStore:function(c,d,f){if(!c||!d)throw new Error(e);var g=b("getByType",null,{app:c,dataType:d});a.blackberryCommunication(g,f)},getStorageRequest:function(a,b,c,d){if(null===b)throw new Error("app cannot be null");if(null===a)throw new Error("dataType cannot be null");var e={app:b,dataType:a};return null!==c&&(e.id=c),d&&(e.data=d),e},millisToDate:function(a){return new Date(parseInt(a,10))},storeFile:function(a,b,d,e,f){function g(){var c=new FileTransfer,g=encodeURI(b),h="cdvfile://localhost/persistent/"+a;return c.download(g,h,d,e,f)}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,g,c)},uploadFile:function(a,b,d,e,f){function g(){var c=new FileTransfer,g=encodeURI(b),h="cdvfile://localhost/persistent/"+a;return c.upload(h,g,d,e,f)}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,g,c)},getFile:function(a,b,d,e){function f(b){b.root.getFile(a,null,g,c)}function g(a){a.file(h,d)}function h(a){var c=new FileReader;c.onloadend=function(a){b(a.target.result)},c.readAsDataURL(a)}e=e||{},e.fileSystem=e.fileSystem||LocalFileSystem.PERSISTENT,e.resolveLocalFileSystemURL?window.resolveLocalFileSystemURL(a,g,d):window.requestFileSystem(e.fileSystem,0,f,c)}};return f}function AppWorksOffline(a){"use strict";function b(){a.network=a.network||{},a.network.online=!0,a.network.offline=!1,setTimeout(f,2e3)}function c(){a.network=a.network||{},a.network.online=!1,a.network.offline=!0}function d(b){a.cache.getItem(m,b)}function e(){a.cache.removeItem(m)}function f(){function b(a){if(a){for(var b=a.length-1;b>=0;b-=1)i(a[b]);e()}}a.network.online&&d(b)}function g(a,b){for(var c=0;c<a.length;c+=1)if(a[c].id===b)return c;return-1}function h(a){for(var b in a)l.setRequestHeader(b,a[b])}function i(a){var b;l=new XMLHttpRequest,l.addEventListener("load",function(){var c={detail:{data:l.response,status:l.status}};200===l.status?(b=new CustomEvent(a.id,c),b.data=l.response,document.dispatchEvent(b)):200!==l.status&&(b=new CustomEvent(a.id+"__error",c),b.data=l.response,document.dispatchEvent(b))}),l.open(a.options.method,a.url,!0),h(a.options),l.send(a.data||null)}function j(a,b){return document.addEventListener(a,b)}function k(a,b){return document.removeEventListener(a,b)}a.network={online:"onLine"in navigator&&navigator.onLine,offline:"onLine"in navigator&&!navigator.onLine},document.addEventListener("online",f),document.addEventListener("online",b),document.addEventListener("offline",c);var l=new XMLHttpRequest,m="_storedRequests",n={registerEventHandler:j,removeEventHandler:k,flush:f,queuedRequests:d,id:String.random,queue:function(b,c){function d(b){b&&-1===g(b,n.id)?(b.push(n),a.cache.setItem(m,b)):a.cache.setItem(m,[n])}function e(){c=c||{},c.eventListener=c.eventListener||l,c.method=c.method||"GET",c.headers=c.headers||{}}function f(b){return j(l,b),a.network.online&&i(n),{error:h}}function h(a){j(l+"__error",a)}function k(a,b){f(a),h(b)}var l=c.eventListener||String.random(),n={id:l,url:b,options:c};return e(),a.network.offline&&a.cache.getItem(m,d),{success:f,error:h,then:k}}};return n}function AppWorksNotifications(a){"use strict";function b(a){n.push(a.data),h&&h(a.data)}function c(a){h=a}function d(){return n}function e(){n=[]}function f(){m.onmessage=b}function g(){e(),m.onmessage=null}var h,i="appworks",j="127.0.0.1",k="9000",l="ws://"+j+":"+k,m=new WebSocket(l,i),n=[];f();var o={get:d,clear:e,on:f,off:g,handler:c};return o}!function(a){"use strict";function b(){if(c.storage=new AppWorksStorage(c),c.cache=new AppWorksCache(c),c.comms=new AppWorksComms(c),c.offline=new AppWorksOffline(c),c.notifications=new AppWorksNotifications(c),!a.cordova)throw new Error("cordova not found. deviceready should not have been fired but it was");c.accelerometer=a.navigator.accelerometer,c.battery=a.navigator.battery,c.cancelVibration=a.navigator.cancelVibration,c.compass=a.navigator.compass,c.connection=a.navigator.connection,c.contacts=a.navigator.contacts,c.device=a.navigator.device,c.globalization=a.navigator.globalization,c.getStorageUpdates=a.navigator.getStorageUpdates,a.appworks=c}var c=new AppWorksCore;document.addEventListener("deviceready",b),a.appworks=c}(window);